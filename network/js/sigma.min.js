/* sigmajs.org - an open-source light-weight JavaScript graph drawing library - Version: 0.1 - Author:  Alexis Jacomy - License: MIT */
var sigma={tools:{},classes:{},instances:{}};
(function(){Array.prototype.some||(Array.prototype.some=function(y,k){var j=this.length;if("function"!=typeof y)throw new TypeError;for(var a=0;a<j;a++)if(a in this&&y.call(k,this[a],a,this))return!0;return!1});Array.prototype.forEach||(Array.prototype.forEach=function(k,j){var l=this.length;if(typeof k!="function")throw new TypeError;for(var a=0;a<l;a++)a in this&&k.call(j,this[a],a,this)});Array.prototype.map||(Array.prototype.map=function(k,j){var l=this.length;if(typeof k!="function")throw new TypeError;
for(var a=Array(l),i=0;i<l;i++)i in this&&(a[i]=k.call(j,this[i],i,this));return a});Array.prototype.filter||(Array.prototype.filter=function(k,j){var l=this.length;if(typeof k!="function")throw new TypeError;for(var a=[],i=0;i<l;i++)if(i in this){var h=this[i];k.call(j,h,i,this)&&a.push(h)}return a});if(!Object.keys){var k=Object,n=Object.prototype.hasOwnProperty,j=!{toString:null}.propertyIsEnumerable("toString"),l="toString toLocaleString valueOf hasOwnProperty isPrototypeOf propertyIsEnumerable constructor".split(" "),
B=l.length;k.keys=function(k){if(typeof k!=="object"&&typeof k!=="function"||k===null)throw new TypeError("Object.keys called on non-object");var w=[],t;for(t in k)n.call(k,t)&&w.push(t);if(j)for(t=0;t<B;t++)n.call(k,l[t])&&w.push(l[t]);return w}}})();sigma.classes.Cascade=function(){this.p={};this.config=function(k,n){if("string"==typeof k&&void 0==n)return this.p[k];var j="object"==typeof k&&void 0==n?k:{};"string"==typeof k&&(j[k]=n);for(var l in j)void 0!=this.p[l]&&(this.p[l]=j[l]);return this}};
sigma.classes.EventDispatcher=function(){var k={},n=this;this.one=function(j,l){if(!l||!j)return n;("string"==typeof j?j.split(" "):j).forEach(function(j){k[j]||(k[j]=[]);k[j].push({h:l,one:!0})});return n};this.bind=function(j,l){if(!l||!j)return n;("string"==typeof j?j.split(" "):j).forEach(function(j){k[j]||(k[j]=[]);k[j].push({h:l,one:!1})});return n};this.unbind=function(j,l){j||(k={});var B="string"==typeof j?j.split(" "):j;l?B.forEach(function(j){k[j]&&(k[j]=k[j].filter(function(j){return j.h!=
l}));k[j]&&0==k[j].length&&delete k[j]}):B.forEach(function(j){delete k[j]});return n};this.dispatch=function(j,l){k[j]&&(k[j].forEach(function(k){k.h({type:j,content:l,target:n})}),k[j]=k[j].filter(function(j){return!j.one}));return n}};
(function(){function k(){function a(f){return{x:f.x,y:f.y,size:f.size,degree:f.degree,inDegree:f.inDegree,outDegree:f.outDegree,displayX:f.displayX,displayY:f.displayY,displaySize:f.displaySize,label:f.label,id:f.id,color:f.color,fixed:f.fixed,active:f.active,hidden:f.hidden,forceLabel:f.forceLabel,attr:f.attr}}function i(f){return{source:f.source.id,target:f.target.id,size:f.size,type:f.type,weight:f.weight,displaySize:f.displaySize,label:f.label,hidden:f.hidden,id:f.id,attr:f.attr,color:f.color}}
function h(){c.nodes=[];c.nodesIndex={};c.edges=[];c.edgesIndex={};return c}sigma.classes.Cascade.call(this);sigma.classes.EventDispatcher.call(this);var c=this;this.p={minNodeSize:0,maxNodeSize:0,minEdgeSize:0,maxEdgeSize:0,scalingMode:"inside",nodesPowRatio:0.5,edgesPowRatio:0};this.borders={};h();this.addNode=function(f,d){if(c.nodesIndex[f])throw Error('Node "'+f+'" already exists.');var d=d||{},b={x:0,y:0,size:1,degree:0,inDegree:0,outDegree:0,fixed:!1,active:!1,hidden:!1,forceLabel:!1,label:f.toString(),
id:f.toString(),attr:{}},a;for(a in d)switch(a){case "id":break;case "x":case "y":case "size":b[a]=+d[a];break;case "fixed":case "active":case "hidden":case "forceLabel":b[a]=!!d[a];break;case "color":case "label":b[a]=d[a];break;default:b.attr[a]=d[a]}c.nodes.push(b);c.nodesIndex[f.toString()]=b;return c};this.addEdge=function(a,d,b,h){if(c.edgesIndex[a])throw Error('Edge "'+a+'" already exists.');if(!c.nodesIndex[d])throw Error("Edge's source \""+d+'" does not exist yet.');if(!c.nodesIndex[b])throw Error("Edge's target \""+
b+'" does not exist yet.');h=h||{};d={source:c.nodesIndex[d],target:c.nodesIndex[b],size:1,weight:1,displaySize:0.5,label:a.toString(),id:a.toString(),hidden:!1,attr:{}};d.source.degree++;d.source.outDegree++;d.target.degree++;d.target.inDegree++;for(var m in h)switch(m){case "id":case "source":case "target":break;case "hidden":d[m]=!!h[m];break;case "size":case "weight":d[m]=+h[m];break;case "color":d[m]=h[m].toString();break;case "type":d[m]=h[m].toString();break;case "label":d[m]=h[m];break;default:d.attr[m]=
h[m]}c.edges.push(d);c.edgesIndex[a.toString()]=d;return c};this.dropNode=function(a){((a instanceof Array?a:[a])||[]).forEach(function(d){if(c.nodesIndex[d]){var a=null;c.nodes.some(function(c,f){return c.id==d?(a=f,!0):!1});null!=a&&c.nodes.splice(a,1);delete c.nodesIndex[d];c.edges=c.edges.filter(function(a){return a.source.id==d?(delete c.edgesIndex[a.id],a.target.degree--,a.target.inDegree--,!1):a.target.id==d?(delete c.edgesIndex[a.id],a.source.degree--,a.source.outDegree--,!1):!0})}else sigma.log('Node "'+
d+'" does not exist.')});return c};this.dropEdge=function(a){((a instanceof Array?a:[a])||[]).forEach(function(a){if(c.edgesIndex[a]){c.edgesIndex[a].source.degree--;c.edgesIndex[a].source.outDegree--;c.edgesIndex[a].target.degree--;c.edgesIndex[a].target.inDegree--;var b=null;c.edges.some(function(c,f){return c.id==a?(b=f,!0):!1});null!=b&&c.edges.splice(b,1);delete c.edgesIndex[a]}else sigma.log('Edge "'+a+'" does not exist.')});return c};this.iterEdges=function(a,d){var b=d?d.map(function(a){return c.edgesIndex[a]}):
c.edges,h=b.map(i);h.forEach(a);b.forEach(function(a,b){var d=h[b],f;for(f in d)switch(f){case "id":case "displaySize":break;case "weight":case "size":a[f]=+d[f];break;case "source":case "target":a[f]=c.nodesIndex[f]||a[f];break;case "hidden":a[f]=!!d[f];break;case "color":case "label":case "type":a[f]=(d[f]||"").toString();break;default:a.attr[f]=d[f]}});return c};this.iterNodes=function(f,d){var b=d?d.map(function(a){return c.nodesIndex[a]}):c.nodes,h=b.map(a);h.forEach(f);b.forEach(function(a,
d){var b=h[d],f;for(f in b)switch(f){case "id":case "attr":case "degree":case "inDegree":case "outDegree":case "displayX":case "displayY":case "displaySize":break;case "x":case "y":case "size":a[f]=+b[f];break;case "fixed":case "active":case "hidden":case "forceLabel":a[f]=!!b[f];break;case "color":case "label":a[f]=(b[f]||"").toString();break;default:a.attr[f]=b[f]}});return c};this.getEdges=function(a){var d=((a instanceof Array?a:[a])||[]).map(function(a){return i(c.edgesIndex[a])});return a instanceof
Array?d:d[0]};this.getNodes=function(f){var d=((f instanceof Array?f:[f])||[]).map(function(b){return a(c.nodesIndex[b])});return f instanceof Array?d:d[0]};this.empty=h;this.rescale=function(a,d,b,h){var i=0,g=0;b&&c.nodes.forEach(function(a){g=Math.max(a.size,g)});h&&c.edges.forEach(function(a){i=Math.max(a.size,i)});var g=g||1,i=i||1,z,j,o,p;b&&c.nodes.forEach(function(a){j=Math.max(a.x,j||a.x);z=Math.min(a.x,z||a.x);p=Math.max(a.y,p||a.y);o=Math.min(a.y,o||a.y)});var v="outside"==c.p.scalingMode?
Math.max(a/Math.max(j-z,1),d/Math.max(p-o,1)):Math.min(a/Math.max(j-z,1),d/Math.max(p-o,1)),k=(c.p.maxNodeSize||g)/v;j+=k;z-=k;p+=k;o-=k;var v="outside"==c.p.scalingMode?Math.max(a/Math.max(j-z,1),d/Math.max(p-o,1)):Math.min(a/Math.max(j-z,1),d/Math.max(p-o,1)),l,r;!c.p.maxNodeSize&&!c.p.minNodeSize?(l=1,r=0):c.p.maxNodeSize==c.p.minNodeSize?(l=0,r=c.p.maxNodeSize):(l=(c.p.maxNodeSize-c.p.minNodeSize)/g,r=c.p.minNodeSize);var u,E;!c.p.maxEdgeSize&&!c.p.minEdgeSize?(u=1,E=0):(u=c.p.maxEdgeSize==c.p.minEdgeSize?
0:(c.p.maxEdgeSize-c.p.minEdgeSize)/i,E=c.p.minEdgeSize);b&&c.nodes.forEach(function(b){b.displaySize=b.size*l+r;if(!b.fixed){b.displayX=(b.x-(j+z)/2)*v+a/2;b.displayY=(b.y-(p+o)/2)*v+d/2}});h&&c.edges.forEach(function(a){a.displaySize=a.size*u+E});return c};this.translate=function(a,d,b,h,i){var g=Math.pow(b,c.p.nodesPowRatio);h&&c.nodes.forEach(function(c){c.fixed||(c.displayX=c.displayX*b+a,c.displayY=c.displayY*b+d);c.displaySize*=g});g=Math.pow(b,c.p.edgesPowRatio);i&&c.edges.forEach(function(a){a.displaySize*=
g});return c};this.setBorders=function(){c.borders={};c.nodes.forEach(function(a){c.borders.minX=Math.min(void 0==c.borders.minX?a.displayX-a.displaySize:c.borders.minX,a.displayX-a.displaySize);c.borders.maxX=Math.max(void 0==c.borders.maxX?a.displayX+a.displaySize:c.borders.maxX,a.displayX+a.displaySize);c.borders.minY=Math.min(void 0==c.borders.minY?a.displayY-a.displaySize:c.borders.minY,a.displayY-a.displaySize);c.borders.maxY=Math.max(void 0==c.borders.maxY?a.displayY-a.displaySize:c.borders.maxY,
a.displayY-a.displaySize)})};this.checkHover=function(a,d){var b,h,i,g=[],j=[];c.nodes.forEach(function(c){if(c.hidden)c.hover=!1;else{b=Math.abs(c.displayX-a);h=Math.abs(c.displayY-d);i=c.displaySize;var o=c.hover,p=b<i&&h<i&&Math.sqrt(b*b+h*h)<i;o&&!p?(c.hover=!1,j.push(c.id)):p&&!o&&(c.hover=!0,g.push(c.id))}});g.length&&c.dispatch("overnodes",g);j.length&&c.dispatch("outnodes",j);return c}}function n(a,i){function h(){var a;a="<p>GLOBAL :</p>";for(var d in c.p.globalProbes)a+="<p>"+d+" : "+c.p.globalProbes[d]()+
"</p>";a+="<br><p>LOCAL :</p>";for(d in c.p.localProbes)a+="<p>"+d+" : "+c.p.localProbes[d]()+"</p>";c.p.dom.innerHTML=a;return c}sigma.classes.Cascade.call(this);var c=this;this.instance=a;this.monitoring=!1;this.p={fps:40,dom:i,globalProbes:{"Time (ms)":sigma.chronos.getExecutionTime,Queue:sigma.chronos.getQueuedTasksCount,Tasks:sigma.chronos.getTasksCount,FPS:sigma.chronos.getFPS},localProbes:{"Nodes count":function(){return c.instance.graph.nodes.length},"Edges count":function(){return c.instance.graph.edges.length}}};
this.activate=function(){c.monitoring||(c.monitoring=window.setInterval(h,1E3/c.p.fps));return c};this.desactivate=function(){c.monitoring&&(window.clearInterval(c.monitoring),c.monitoring=null,c.p.dom.innerHTML="");return c}}function j(a){function i(a){d.p.mouseEnabled&&(c(d.mouseX,d.mouseY,d.ratio*(0<(void 0!=a.wheelDelta&&a.wheelDelta||void 0!=a.detail&&-a.detail)?d.p.zoomMultiply:1/d.p.zoomMultiply)),d.p.blockScroll&&(a.preventDefault?a.preventDefault():a.returnValue=!1))}function h(){var a=d.mouseX-
b+m,c=d.mouseY-j+g;if(a!=d.stageX||c!=d.stageY)v=p,D=n,p=a,n=c,d.stageX=a,d.stageY=c,d.dispatch("drag")}function c(a,c,b){if(!d.isMouseDown&&(window.clearInterval(d.interpolationID),u=void 0!=b,m=d.stageX,l=a,g=d.stageY,o=c,k=b||d.ratio,k=Math.min(Math.max(k,d.p.minRatio),d.p.maxRatio),r=d.p.directZooming?1-(u?d.p.zoomDelta:d.p.dragDelta):0,d.ratio!=k||d.stageX!=l||d.stageY!=o))f(),d.interpolationID=window.setInterval(f,50),d.dispatch("startinterpolate")}function f(){r+=u?d.p.zoomDelta:d.p.dragDelta;
r=Math.min(r,1);var a=sigma.easing.quadratic.easeout(r),c=d.ratio;d.ratio=c*(1-a)+k*a;u?(d.stageX=l+(d.stageX-l)*d.ratio/c,d.stageY=o+(d.stageY-o)*d.ratio/c):(d.stageX=m*(1-a)+l*a,d.stageY=g*(1-a)+o*a);d.dispatch("interpolate");1<=r&&(window.clearInterval(d.interpolationID),a=d.ratio,u?(d.ratio=k,d.stageX=l+(d.stageX-l)*d.ratio/a,d.stageY=o+(d.stageY-o)*d.ratio/a):(d.stageX=l,d.stageY=o),d.dispatch("stopinterpolate"))}sigma.classes.Cascade.call(this);sigma.classes.EventDispatcher.call(this);var d=
this;this.p={minRatio:1,maxRatio:32,marginRatio:1,zoomDelta:0.1,dragDelta:0.3,zoomMultiply:2,directZooming:!1,blockScroll:!0,inertia:1.1,mouseEnabled:!0,touchEnabled:!0};var b=0,j=0,m=0,g=0,k=1,l=0,o=0,p=0,v=0,n=0,D=0,r=0,u=!1;this.stageY=this.stageX=0;this.ratio=1;this.mouseY=this.mouseX=0;this.isTouchDown=this.isMouseDown=!1;a.addEventListener("DOMMouseScroll",i,!0);a.addEventListener("mousewheel",i,!0);a.addEventListener("mousemove",function(a){d.mouseX=void 0!=a.offsetX&&a.offsetX||void 0!=a.layerX&&
a.layerX||void 0!=a.clientX&&a.clientX;d.mouseY=void 0!=a.offsetY&&a.offsetY||void 0!=a.layerY&&a.layerY||void 0!=a.clientY&&a.clientY;d.isMouseDown&&h(a);d.dispatch("move");a.preventDefault?a.preventDefault():a.returnValue=!1},!0);a.addEventListener("mousedown",function(a){d.p.mouseEnabled&&(d.isMouseDown=!0,d.dispatch("mousedown"),m=d.stageX,g=d.stageY,b=d.mouseX,j=d.mouseY,v=p=d.stageX,D=n=d.stageY,d.dispatch("startdrag"),a.preventDefault?a.preventDefault():a.returnValue=!1)},!0);document.addEventListener("mouseup",
function(a){d.p.mouseEnabled&&d.isMouseDown&&(d.isMouseDown=!1,d.dispatch("mouseup"),(m!=d.stageX||g!=d.stageY)&&c(d.stageX+d.p.inertia*(d.stageX-v),d.stageY+d.p.inertia*(d.stageY-D)),a.preventDefault?a.preventDefault():a.returnValue=!1)},!0);a.addEventListener("touchmove",function(a){var c=a.targetTouches[0];d.mouseX=c.pageX;d.mouseY=c.pageY;d.isTouchDown&&h(a);d.dispatch("move");a.preventDefault?a.preventDefault():a.returnValue=!1},!0);this.checkBorders=function(){return d};this.interpolate=c}function l(a,
i,h,c,f,d,b){function j(a){var b=c,d="fixed"==g.p.labelSize?g.p.defaultLabelSize:g.p.labelSizeRatio*a.displaySize;b.font=(g.p.hoverFontStyle||g.p.fontStyle||"")+" "+d+"px "+(g.p.hoverFont||g.p.font||"");b.fillStyle="node"==g.p.labelHoverBGColor?a.color||g.p.defaultNodeColor:g.p.defaultHoverLabelBGColor;b.beginPath();g.p.labelHoverShadow&&(b.shadowOffsetX=0,b.shadowOffsetY=0,b.shadowBlur=4,b.shadowColor=g.p.labelHoverShadowColor);sigma.tools.drawRoundRect(b,Math.round(a.displayX-d/2-2),Math.round(a.displayY-
d/2-2),Math.round(b.measureText(a.label).width+1.5*a.displaySize+d/2+4),Math.round(d+4),Math.round(d/2+2),"left");b.closePath();b.fill();b.shadowOffsetX=0;b.shadowOffsetY=0;b.shadowBlur=0;b.beginPath();b.fillStyle="node"==g.p.nodeBorderColor?a.color||g.p.defaultNodeColor:g.p.defaultNodeBorderColor;b.arc(Math.round(a.displayX),Math.round(a.displayY),a.displaySize+g.p.borderSize,0,2*Math.PI,!0);b.closePath();b.fill();b.beginPath();b.fillStyle="node"==g.p.nodeHoverColor?a.color||g.p.defaultNodeColor:
g.p.defaultNodeHoverColor;b.arc(Math.round(a.displayX),Math.round(a.displayY),a.displaySize,0,2*Math.PI,!0);b.closePath();b.fill();b.fillStyle="node"==g.p.labelHoverColor?a.color||g.p.defaultNodeColor:g.p.defaultLabelHoverColor;b.fillText(a.label,Math.round(a.displayX+1.5*a.displaySize),Math.round(a.displayY+d/2-3));return g}function m(a){if(isNaN(a.x)||isNaN(a.y))throw Error("A node's coordinate is not a number (id: "+a.id+")");return!a.hidden&&a.displayX+a.displaySize>-k/3&&a.displayX-a.displaySize<
4*k/3&&a.displayY+a.displaySize>-l/3&&a.displayY-a.displaySize<4*l/3}sigma.classes.Cascade.call(this);var g=this;this.p={labelColor:"default",defaultLabelColor:"#000",labelHoverBGColor:"default",defaultHoverLabelBGColor:"#fff",labelHoverShadow:!0,labelHoverShadowColor:"#000",labelHoverColor:"default",defaultLabelHoverColor:"#000",labelActiveBGColor:"default",defaultActiveLabelBGColor:"#fff",labelActiveShadow:!0,labelActiveShadowColor:"#000",labelActiveColor:"default",defaultLabelActiveColor:"#000",
labelSize:"fixed",defaultLabelSize:12,labelSizeRatio:2,labelThreshold:6,font:"Arial",hoverFont:"",activeFont:"",fontStyle:"",hoverFontStyle:"",activeFontStyle:"",edgeColor:"source",defaultEdgeColor:"#aaa",defaultEdgeType:"line",defaultNodeColor:"#aaa",nodeHoverColor:"node",defaultNodeHoverColor:"#fff",nodeActiveColor:"node",defaultNodeActiveColor:"#fff",borderSize:0,nodeBorderColor:"node",defaultNodeBorderColor:"#fff",edgesSpeed:200,nodesSpeed:200,labelsSpeed:200};var k=d,l=b;this.currentLabelIndex=
this.currentNodeIndex=this.currentEdgeIndex=0;this.task_drawLabel=function(){for(var a=f.nodes.length,b=0;b++<g.p.labelsSpeed&&g.currentLabelIndex<a;)if(g.isOnScreen(f.nodes[g.currentLabelIndex])){var c=f.nodes[g.currentLabelIndex++],d=h;if(c.displaySize>=g.p.labelThreshold||c.forceLabel){var i="fixed"==g.p.labelSize?g.p.defaultLabelSize:g.p.labelSizeRatio*c.displaySize;d.font=g.p.fontStyle+i+"px "+g.p.font;d.fillStyle="node"==g.p.labelColor?c.color||g.p.defaultNodeColor:g.p.defaultLabelColor;d.fillText(c.label,
Math.round(c.displayX+1.5*c.displaySize),Math.round(c.displayY+i/2-3))}}else g.currentLabelIndex++;return g.currentLabelIndex<a};this.task_drawEdge=function(){for(var a=f.edges.length,b,c,d=0;d++<g.p.edgesSpeed&&g.currentEdgeIndex<a;)if(e=f.edges[g.currentEdgeIndex],b=e.source,c=e.target,e.hidden||b.hidden||c.hidden||!g.isOnScreen(b)&&!g.isOnScreen(c))g.currentEdgeIndex++;else{b=f.edges[g.currentEdgeIndex++];c=b.source.displayX;var h=b.source.displayY,j=b.target.displayX,k=b.target.displayY,m=b.color;
if(!m)switch(g.p.edgeColor){case "source":m=b.source.color||g.p.defaultNodeColor;break;case "target":m=b.target.color||g.p.defaultNodeColor;break;default:m=g.p.defaultEdgeColor}var l=i;switch(b.type||g.p.defaultEdgeType){case "curve":l.strokeStyle=m;l.lineWidth=b.displaySize/3;l.beginPath();l.moveTo(c,h);l.quadraticCurveTo((c+j)/2+(k-h)/4,(h+k)/2+(c-j)/4,j,k);l.stroke();break;default:l.strokeStyle=m,l.lineWidth=b.displaySize/3,l.beginPath(),l.moveTo(c,h),l.lineTo(j,k),l.stroke()}}return g.currentEdgeIndex<
a};this.task_drawNode=function(){for(var b=f.nodes.length,c=0;c++<g.p.nodesSpeed&&g.currentNodeIndex<b;)if(g.isOnScreen(f.nodes[g.currentNodeIndex])){var d=f.nodes[g.currentNodeIndex++],h=Math.round(10*d.displaySize)/10,i=a;i.fillStyle=d.color;i.beginPath();i.arc(d.displayX,d.displayY,h,0,2*Math.PI,!0);i.closePath();i.fill();d.hover&&j(d)}else g.currentNodeIndex++;return g.currentNodeIndex<b};this.drawActiveNode=function(a){var b=c;if(!m(a))return g;var d="fixed"==g.p.labelSize?g.p.defaultLabelSize:
g.p.labelSizeRatio*a.displaySize;b.font=(g.p.activeFontStyle||g.p.fontStyle||"")+" "+d+"px "+(g.p.activeFont||g.p.font||"");b.fillStyle="node"==g.p.labelHoverBGColor?a.color||g.p.defaultNodeColor:g.p.defaultActiveLabelBGColor;b.beginPath();g.p.labelActiveShadow&&(b.shadowOffsetX=0,b.shadowOffsetY=0,b.shadowBlur=4,b.shadowColor=g.p.labelActiveShadowColor);sigma.tools.drawRoundRect(b,Math.round(a.displayX-d/2-2),Math.round(a.displayY-d/2-2),Math.round(b.measureText(a.label).width+1.5*a.displaySize+
d/2+4),Math.round(d+4),Math.round(d/2+2),"left");b.closePath();b.fill();b.shadowOffsetX=0;b.shadowOffsetY=0;b.shadowBlur=0;b.beginPath();b.fillStyle="node"==g.p.nodeBorderColor?a.color||g.p.defaultNodeColor:g.p.defaultNodeBorderColor;b.arc(Math.round(a.displayX),Math.round(a.displayY),a.displaySize+g.p.borderSize,0,2*Math.PI,!0);b.closePath();b.fill();b.beginPath();b.fillStyle="node"==g.p.nodeActiveColor?a.color||g.p.defaultNodeColor:g.p.defaultNodeActiveColor;b.arc(Math.round(a.displayX),Math.round(a.displayY),
a.displaySize,0,2*Math.PI,!0);b.closePath();b.fill();b.fillStyle="node"==g.p.labelActiveColor?a.color||g.p.defaultNodeColor:g.p.defaultLabelActiveColor;b.fillText(a.label,Math.round(a.displayX+1.5*a.displaySize),Math.round(a.displayY+d/2-3));return g};this.drawHoverNode=j;this.isOnScreen=m;this.resize=function(a,b){k=a;l=b;return g}}function B(a,i){function h(){sigma.chronos.removeTask("node_"+b.id,2).removeTask("edge_"+b.id,2).removeTask("label_"+b.id,2).stopTasks();return b}function c(a,c){b.domElements[a]=
document.createElement(c);b.domElements[a].style.position="absolute";b.domElements[a].setAttribute("id","sigma_"+a+"_"+b.id);b.domElements[a].setAttribute("class","sigma_"+a+"_"+c);b.domElements[a].setAttribute("width",b.width+"px");b.domElements[a].setAttribute("height",b.height+"px");b.domRoot.appendChild(b.domElements[a]);return b}function f(){b.p.drawHoverNodes&&(b.graph.checkHover(b.mousecaptor.mouseX,b.mousecaptor.mouseY),b.graph.nodes.forEach(function(a){a.hover&&!a.active&&b.plotter.drawHoverNode(a)}));
return b}function d(){b.p.drawActiveNodes&&b.graph.nodes.forEach(function(a){a.active&&b.plotter.drawActiveNode(a)});return b}sigma.classes.Cascade.call(this);sigma.classes.EventDispatcher.call(this);var b=this;this.id=i.toString();this.p={auto:!0,drawNodes:2,drawEdges:1,drawLabels:2,lastNodes:2,lastEdges:0,lastLabels:2,drawHoverNodes:!0,drawActiveNodes:!0};this.domRoot=a;this.width=this.domRoot.offsetWidth;this.height=this.domRoot.offsetHeight;this.graph=new k;this.domElements={};c("edges","canvas");
c("nodes","canvas");c("labels","canvas");c("hover","canvas");c("monitor","div");c("mouse","canvas");this.plotter=new l(this.domElements.nodes.getContext("2d"),this.domElements.edges.getContext("2d"),this.domElements.labels.getContext("2d"),this.domElements.hover.getContext("2d"),this.graph,this.width,this.height);this.monitor=new n(this,this.domElements.monitor);this.mousecaptor=new j(this.domElements.mouse,this.id);this.mousecaptor.bind("drag interpolate",function(){b.draw(b.p.auto?2:b.p.drawNodes,
b.p.auto?0:b.p.drawEdges,b.p.auto?2:b.p.drawLabels,!0)}).bind("stopdrag stopinterpolate",function(){b.draw(b.p.auto?2:b.p.drawNodes,b.p.auto?1:b.p.drawEdges,b.p.auto?2:b.p.drawLabels,!0)}).bind("mousedown mouseup",function(a){var c=b.graph.nodes.filter(function(a){return!!a.hover}).map(function(a){return a.id});b.dispatch("mousedown"==a.type?"downgraph":"upgraph");c.length&&b.dispatch("mousedown"==a.type?"downnodes":"upnodes",c)}).bind("move",function(){b.domElements.hover.getContext("2d").clearRect(0,
0,b.domElements.hover.width,b.domElements.hover.height);f();d()});sigma.chronos.bind("startgenerators",function(){sigma.chronos.getGeneratorsIDs().some(function(a){return!!a.match(RegExp("_ext_"+b.id+"$",""))})&&b.draw(b.p.auto?2:b.p.drawNodes,b.p.auto?0:b.p.drawEdges,b.p.auto?2:b.p.drawLabels)}).bind("stopgenerators",function(){b.draw()});for(var C=0;C<t.plugins.length;C++)t.plugins[C](this);this.draw=function(a,c,d,f){if(f&&sigma.chronos.getGeneratorsIDs().some(function(a){return!!a.match(RegExp("_ext_"+
b.id+"$",""))}))return b;a=void 0==a?b.p.drawNodes:a;c=void 0==c?b.p.drawEdges:c;d=void 0==d?b.p.drawLabels:d;f={nodes:a,edges:c,labels:d};b.p.lastNodes=a;b.p.lastEdges=c;b.p.lastLabels=d;h();b.graph.rescale(b.width,b.height,0<a,0<c).setBorders();b.mousecaptor.checkBorders(b.graph.borders,b.width,b.height);b.graph.translate(b.mousecaptor.stageX,b.mousecaptor.stageY,b.mousecaptor.ratio,0<a,0<c);b.dispatch("graphscaled");for(var i in b.domElements)"canvas"==b.domElements[i].nodeName.toLowerCase()&&
(void 0==f[i]||0<=f[i])&&b.domElements[i].getContext("2d").clearRect(0,0,b.domElements[i].width,b.domElements[i].height);b.plotter.currentEdgeIndex=0;b.plotter.currentNodeIndex=0;b.plotter.currentLabelIndex=0;i=null;f=!1;if(a)if(1<a)for(;b.plotter.task_drawNode(););else sigma.chronos.addTask(b.plotter.task_drawNode,"node_"+b.id,!1),f=!0,i="node_"+b.id;if(d)if(1<d)for(;b.plotter.task_drawLabel(););else i?sigma.chronos.queueTask(b.plotter.task_drawLabel,"label_"+b.id,i):sigma.chronos.addTask(b.plotter.task_drawLabel,
"label_"+b.id,!1),f=!0,i="label_"+b.id;if(c)if(1<c)for(;b.plotter.task_drawEdge(););else i?sigma.chronos.queueTask(b.plotter.task_drawEdge,"edge_"+b.id,i):sigma.chronos.addTask(b.plotter.task_drawEdge,"edge_"+b.id,!1),f=!0,i="edge_"+b.id;b.dispatch("draw");b.refresh();f&&sigma.chronos.runTasks();return b};this.resize=function(a,c){var d=b.width,f=b.height;void 0!=a&&void 0!=c?(b.width=a,b.height=c):(b.width=b.domRoot.offsetWidth,b.height=b.domRoot.offsetHeight);if(d!=b.width||f!=b.height){for(var h in b.domElements)b.domElements[h].setAttribute("width",
b.width+"px"),b.domElements[h].setAttribute("height",b.height+"px");b.plotter.resize(b.width,b.height);b.draw(b.p.lastNodes,b.p.lastEdges,b.p.lastLabels,!0)}return b};this.refresh=function(){b.domElements.hover.getContext("2d").clearRect(0,0,b.domElements.hover.width,b.domElements.hover.height);f();d();return b};this.drawHover=f;this.drawActive=d;this.clearSchedule=h;window.addEventListener("resize",function(){b.resize()})}function y(a){var i=this;sigma.classes.EventDispatcher.call(this);this._core=
a;this.kill=function(){};this.getID=function(){return a.id};this.configProperties=function(h,c){var f=a.config(h,c);return f==a?i:f};this.drawingProperties=function(h,c){var f=a.plotter.config(h,c);return f==a.plotter?i:f};this.mouseProperties=function(h,c){var f=a.mousecaptor.config(h,c);return f==a.mousecaptor?i:f};this.graphProperties=function(h,c){var f=a.graph.config(h,c);return f==a.graph?i:f};this.getMouse=function(){return{mouseX:a.mousecaptor.mouseX,mouseY:a.mousecaptor.mouseY,down:a.mousecaptor.isMouseDown}};
this.position=function(h,c,f){if(0==arguments.length)return{stageX:a.mousecaptor.stageX,stageY:a.mousecaptor.stageY,ratio:a.mousecaptor.ratio};a.mousecaptor.stageX=void 0!=h?h:a.mousecaptor.stageX;a.mousecaptor.stageY=void 0!=c?c:a.mousecaptor.stageY;a.mousecaptor.ratio=void 0!=f?f:a.mousecaptor.ratio;return i};this.goTo=function(h,c,f){a.mousecaptor.interpolate(h,c,f);return i};this.zoomTo=function(h,c,f){f=Math.min(Math.max(a.mousecaptor.config("minRatio"),f),a.mousecaptor.config("maxRatio"));f==
a.mousecaptor.ratio?a.mousecaptor.interpolate(h-a.width/2+a.mousecaptor.stageX,c-a.height/2+a.mousecaptor.stageY):a.mousecaptor.interpolate((f*h-a.mousecaptor.ratio*a.width/2)/(f-a.mousecaptor.ratio),(f*c-a.mousecaptor.ratio*a.height/2)/(f-a.mousecaptor.ratio),f);return i};this.resize=function(h,c){a.resize(h,c);return i};this.draw=function(h,c,f,d){a.draw(h,c,f,d);return i};this.refresh=function(){a.refresh();return i};this.addGenerator=function(h,c,f){sigma.chronos.addGenerator(h+"_ext_"+a.id,c,
f);return i};this.removeGenerator=function(h){sigma.chronos.removeGenerator(h+"_ext_"+a.id);return i};this.addNode=function(h,c){a.graph.addNode(h,c);return i};this.addEdge=function(h,c,f,d){a.graph.addEdge(h,c,f,d);return i};this.dropNode=function(h){a.graph.dropNode(h);return i};this.dropEdge=function(h){a.graph.dropEdge(h);return i};this.pushGraph=function(h,c){h.nodes&&h.nodes.forEach(function(f){f.id&&(!c||!a.graph.nodesIndex[f.id])&&i.addNode(f.id,f)});h.edges&&h.edges.forEach(function(f){(validID=
f.source&&f.target&&f.id)&&(!c||!a.graph.edgesIndex[f.id])&&i.addNode(f.id,f.source,f.target,f)});return i};this.emptyGraph=function(){a.graph.empty();return i};this.getNodesCount=function(){return a.graph.nodes.length};this.getEdgesCount=function(){return a.graph.edges.length};this.iterNodes=function(h,c){a.graph.iterNodes(h,c);return i};this.iterEdges=function(h,c){a.graph.iterEdges(h,c);return i};this.getNodes=function(h){return a.graph.getNodes(h)};this.getEdges=function(h){return a.graph.getEdges(h)};
this.activateMonitoring=function(){return a.monitor.activate()};this.desactivateMonitoring=function(){return a.monitor.desactivate()};a.bind("downnodes upnodes downgraph upgraph",function(a){i.dispatch(a.type,a.content)});a.graph.bind("overnodes outnodes",function(a){i.dispatch(a.type,a.content)})}var w=0,t={plugins:[]};sigma.init=function(a){a=new B(a,(++w).toString());sigma.instances[w]=new y(a);return sigma.instances[w]};sigma.addPlugin=function(a,i,h){y.prototype[a]=i;t.plugins.push(h)};sigma.chronos=
new function(){function a(a){window.setTimeout(a,0);return g}function i(){for(g.dispatch("frameinserted");l&&s.length&&h(););!l||!s.length?f():(u=(new Date).getTime(),p++,y=w-v,t=v-y,g.dispatch("insertframe"),a(i))}function h(){A%=s.length;if(!s[A].task()){var a=s[A].taskName;x=x.filter(function(b){b.taskParent==a&&s.push({taskName:b.taskName,task:b.task});return b.taskParent!=a});g.dispatch("killed",s.splice(A--,1)[0])}A++;w=(new Date).getTime()-u;return w<=t}function c(){l=!0;p=A=0;r=u=(new Date).getTime();
g.dispatch("start");g.dispatch("insertframe");a(i);return g}function f(){g.dispatch("stop");l=!1;return g}function d(a,b,d){if("function"!=typeof a)throw Error('Task "'+b+'" is not a function');s.push({taskName:b,task:a});l=!(!l&&!(d&&c()||1));return g}function b(a){return a?Object.keys(q).filter(function(a){return!!q[a].on}).length:Object.keys(q).length}function j(){Object.keys(q).length?(g.dispatch("startgenerators"),g.unbind("killed",k),a(function(){for(var a in q)q[a].on=!0,d(q[a].task,a,!1)}),
g.bind("killed",k).runTasks()):g.dispatch("stopgenerators");return g}function k(a){void 0!=q[a.content.taskName]&&(q[a.content.taskName].del||!q[a.content.taskName].condition()?delete q[a.content.taskName]:q[a.content.taskName].on=!1,0==b(!0)&&j())}sigma.classes.EventDispatcher.call(this);var g=this,l=!1,n=80,o=0,p=0,v=1E3/n,t=v,w=0,r=0,u=0,y=0,q={},s=[],x=[],A=0;this.frequency=function(a){return void 0!=a?(n=Math.abs(1*a),v=1E3/n,p=0,g):n};this.runTasks=c;this.stopTasks=f;this.insertFrame=a;this.addTask=
d;this.queueTask=function(a,b,c){if("function"!=typeof a)throw Error('Task "'+b+'" is not a function');if(!s.concat(x).some(function(a){return a.taskName==c}))throw Error('Parent task "'+c+'" of "'+b+'" is not attached.');x.push({taskParent:c,taskName:b,task:a});return g};this.removeTask=function(a,b){if(void 0==a)s=[],1==b?x=[]:2==b&&(s=x,x=[]),f();else{var c="string"==typeof a?a:"";s=s.filter(function(b){return("string"==typeof a?b.taskName==a:b.task==a)?(c=b.taskName,!1):!0});0<b&&(x=x.filter(function(a){1==
b&&a.taskParent==c&&s.push(a);return a.taskParent!=c}))}l=!(s.length&&(!f()||1));return g};this.addGenerator=function(a,c,d){if(void 0!=q[a])return g;q[a]={task:c,condition:d};0==b(!0)&&j();return g};this.removeGenerator=function(a){q[a]&&(q[a].on=!1,q[a].del=!0);return g};this.startGenerators=j;this.getGeneratorsIDs=function(){return Object.keys(q)};this.getFPS=function(){l&&(o=Math.round(1E4*(p/((new Date).getTime()-r)))/10);return o};this.getTasksCount=function(){return s.length};this.getQueuedTasksCount=
function(){return x.length};this.getExecutionTime=function(){return u-r};return this};sigma.debugMode=0;sigma.log=function(){if(1==sigma.debugMode)for(var a in arguments)console.log(arguments[a]);else if(1<sigma.debugMode)for(a in arguments)throw Error(arguments[a]);return sigma};sigma.easing={linear:{},quadratic:{}};sigma.easing.linear.easenone=function(a){return a};sigma.easing.quadratic.easein=function(a){return a*a};sigma.easing.quadratic.easeout=function(a){return-a*(a-2)};sigma.easing.quadratic.easeinout=
function(a){return 1>(a*=2)?0.5*a*a:-0.5*(--a*(a-2)-1)};sigma.tools.drawRoundRect=function(a,i,h,c,f,d,b){var d=d?d:0,j=b?b:[],j="string"==typeof j?j.split(" "):j,b=d&&(0<=j.indexOf("topleft")||0<=j.indexOf("top")||0<=j.indexOf("left")),k=d&&(0<=j.indexOf("topright")||0<=j.indexOf("top")||0<=j.indexOf("right")),g=d&&(0<=j.indexOf("bottomleft")||0<=j.indexOf("bottom")||0<=j.indexOf("left")),j=d&&(0<=j.indexOf("bottomright")||0<=j.indexOf("bottom")||0<=j.indexOf("right"));a.moveTo(i,h+d);b?a.arcTo(i,
h,i+d,h,d):a.lineTo(i,h);k?(a.lineTo(i+c-d,h),a.arcTo(i+c,h,i+c,h+d,d)):a.lineTo(i+c,h);j?(a.lineTo(i+c,h+f-d),a.arcTo(i+c,h+f,i+c-d,h+f,d)):a.lineTo(i+c,h+f);g?(a.lineTo(i+d,h+f),a.arcTo(i,h+f,i,h+f-d,d)):a.lineTo(i,h+f);a.lineTo(i,h+d)};sigma.tools.getRGB=function(a,i){var a=a.toString(),h={r:0,g:0,b:0};if(3<=a.length&&"#"==a.charAt(0)){var c=a.length-1;6==c?h={r:parseInt(a.charAt(1)+a.charAt(2),16),g:parseInt(a.charAt(3)+a.charAt(4),16),b:parseInt(a.charAt(5)+a.charAt(5),16)}:3==c&&(h={r:parseInt(a.charAt(1)+
a.charAt(1),16),g:parseInt(a.charAt(2)+a.charAt(2),16),b:parseInt(a.charAt(3)+a.charAt(3),16)})}i&&(h=[h.r,h.g,h.b]);return h};sigma.tools.rgbToHex=function(a,i,h){return sigma.tools.toHex(a)+sigma.tools.toHex(i)+sigma.tools.toHex(h)};sigma.tools.toHex=function(a){a=parseInt(a,10);if(isNaN(a))return"00";a=Math.max(0,Math.min(a,255));return"0123456789ABCDEF".charAt((a-a%16)/16)+"0123456789ABCDEF".charAt(a%16)};sigma.publicPrototype=y.prototype})();
